## API Report File for "@backstage/plugin-permission-node"

> Do not edit this file. It is a report generated by [API Extractor](https://api-extractor.com/).

```ts
import { AuthorizeRequest } from '@backstage/plugin-permission-common';
import { AuthorizeResult } from '@backstage/plugin-permission-common';
import { BackstageIdentity } from '@backstage/plugin-auth-backend';
import { PermissionCondition } from '@backstage/plugin-permission-common';
import { PermissionCriteria } from '@backstage/plugin-permission-common';
import { Router } from 'express';

// @public
export type ApplyConditionsRequest = {
  resourceRef: string;
  resourceType: string;
  conditions: PermissionCriteria<PermissionCondition>;
};

// @public
export type Condition<TRule> = TRule extends PermissionRule<
  any,
  any,
  infer TParams
>
  ? (...params: TParams) => PermissionCondition<TParams>
  : never;

// @public
export type ConditionalPolicyResult = {
  result: AuthorizeResult.CONDITIONAL;
  conditions: {
    pluginId: string;
    resourceType: string;
    conditions: PermissionCriteria<PermissionCondition>;
  };
};

// @public
export const conditionFor: <TParams extends any[]>(
  rule: PermissionRule<unknown, unknown, TParams>,
) => (...params: TParams) => {
  rule: string;
  params: TParams;
};

// @public
export type Conditions<
  TRules extends Record<string, PermissionRule<any, any>>,
> = {
  [Name in keyof TRules]: Condition<TRules[Name]>;
};

// @public
export const createPermissionIntegration: <
  TResource,
  TRules extends {
    [key: string]: PermissionRule<TResource, any, unknown[]>;
  },
  TGetResourceParams extends any[] = [],
>({
  pluginId,
  resourceType,
  rules,
  getResource,
}: {
  pluginId: string;
  resourceType: string;
  rules: TRules;
  getResource: (
    resourceRef: string,
    ...params: TGetResourceParams
  ) => Promise<TResource | undefined>;
}) => {
  createPermissionIntegrationRouter: (...params: TGetResourceParams) => Router;
  toQuery: (
    conditions: PermissionCriteria<PermissionCondition>,
  ) => PermissionCriteria<QueryType<TRules>>;
  conditions: Conditions<TRules>;
  createConditions: (conditions: PermissionCriteria<PermissionCondition>) => {
    pluginId: string;
    resourceType: string;
    conditions: PermissionCriteria<PermissionCondition>;
  };
  registerPermissionRule: (
    rule: PermissionRule<TResource, QueryType<TRules>, unknown[]>,
  ) => void;
};

// @public
export interface PermissionPolicy {
  // (undocumented)
  handle(
    request: PolicyAuthorizeRequest,
    user?: BackstageIdentity,
  ): Promise<PolicyResult>;
}

// @public
export type PermissionRule<
  TResource,
  TQuery,
  TParams extends unknown[] = unknown[],
> = {
  name: string;
  description: string;
  apply(resource: TResource, ...params: TParams): boolean;
  toQuery(...params: TParams): PermissionCriteria<TQuery>;
};

// @public
export type PolicyAuthorizeRequest = Omit<AuthorizeRequest, 'resourceRef'>;

// @public
export type PolicyResult =
  | {
      result: AuthorizeResult.ALLOW | AuthorizeResult.DENY;
    }
  | ConditionalPolicyResult;

// @public
export type QueryType<TRules> = TRules extends Record<
  string,
  PermissionRule<any, infer TQuery, any>
>
  ? TQuery
  : never;
```
